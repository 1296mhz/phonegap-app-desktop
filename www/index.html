<!DOCTYPE html>
<html>
  <head>
    <title>PhoneGap</title> 
    <link rel="stylesheet" type="text/css" href="css/topcoat-mobile-light.min.css"> 
    <link rel="stylesheet" type="text/css" href="css/topcoat-overlay.min.css"> 
    <script src="js/jquery-2.0.3.min.js"></script>   
    <script src="js/presentation.js"></script>
    <script>
        var fs = require("fs");
        var path = require("path"); 
        global.soundwave = require("phonegap-soundwave");
    
        global.jQuery = jQuery;
        
        global.jQuery(document).ready(function() {
           console.log("ready"); 
           global.projDir = null;
           global.username = null;
           global.password = null;
           global.server = null;
           
           global.soundwave.on("log", function(status, url) { 
               console.log(status, url); 
           });           
           
           global.jQuery("#projectDirectory").change(function() {
               console.log("change handler");
               console.log(global.jQuery("#projectDirectory").val());
               global.projDir = global.jQuery("#projectDirectory").val();
               localStorage.projDir = global.projDir;
               
               enableFormButtons();
               global.jQuery("#currentProjectDir").text("Current project directory: " + global.projDir);
           });
           
           global.jQuery("#createProject").click(function() {
               console.log("create project click handler");
               var option = {};
               option.path = global.projDir;
               
               // TODO: add soundwave.create api call when it has been implemented
               // global.soundwave.create(options);
               console.log("add soundwave.create api call when it has been implemented");              
               alertOverlay("create functionality not implemented");
               
           });
           
           global.jQuery("#openProject").click(function() {
              console.log("open project click handler");
              global.jQuery("#projectDirectory").trigger("click");
           });
           
           global.jQuery("#serveProject").click(function() {
              console.log("serve project click handler");             
              fs.exists(global.projDir + "/www", function(exists) {
                  if (exists) {
                      process.chdir(global.projDir);
                      console.log("project opened at: " + global.projDir);                     
                      global.soundwave.serve({ port: 1337 }, function(e, options) {     
                          if (e) { 
                              console.log("error:", e.message);
                              alertOverlay(e.message); 
                          } else { 
                              console.log("server started at address: " + options.address + ":" + options.port); 
                              global.server = options.server;

                              global.jQuery("#stopServer").prop("disabled", false);
                          }
                      });
                  } else {
                      var errMsg = "an existing project doesn't exist in this folder";
                      console.log(errMsg);
                      alertOverlay(errMsg);
                  }
              });
         
           });
           
           global.jQuery("#stopServer").click(function() {
              console.log("stop server click handler");             
              global.server.close();
              global.jQuery("#stopServer").prop("disabled", true);           
           });
           
           global.jQuery("#alertOk").click(function() {
              hideOverlays();
           });
           
           global.jQuery("#settingsCancel").click(function() {
              console.log("settings cancel click handler");
              hideOverlays();
              // TODO: reset the settings to last saved settings in the localStorage
           });
           
           global.jQuery("#settingsSave").click(function() {
              console.log("settings save click handler");
              hideOverlays();
              // TODO: save the new settings to localStorage
           });
           
           global.jQuery("#settings").click(function() {
              console.log("settings click handler");
              settingsOverlay(); 
           });
                                                             
           initGUI();
           
           if (localStorage.projDir != "") {             
               global.projDir = localStorage.projDir;            
               console.log("localStorage.projDir: " + localStorage.projDir);
               enableFormButtons();
               global.jQuery("#currentProjectDir").text("Current project directory: " + global.projDir);
           }
           
        });
        
    </script> 
    <script src="js/index.js"></script>  
  </head>
  <body>

      <h1>PhoneGap GUI</h1> 

      <div id="overlay-bg" class="topcoat-overlay-bg"></div>
      <aside id="alertOverlay" class="topcoat-overlay">
          <div id="alertContent"></div>
          <div class="topcoat-overlay-buttons">
                  <button id="alertOk" class="topcoat-button"></button>
          </div>
      </aside>
      
      <aside id="settingsOverlay" class="topcoat-overlay">
          <h3>Settings</h3> 
          <div id="settingsContent">
              server ip address: <input type="text" id="ipAddress" class="topcoat-text-input"><br>
              server port: <input type="text" id="portNumber" class="topcoat-text-input">
          </div>
          <div class="topcoat-overlay-buttons">
                  <button id="settingsCancel" class="topcoat-button"></button>
                  <button id="settingsSave" class="topcoat-button--cta"></button>
          </div>
      </aside>
      
      <div id="currentProjectDir"></div><br>

      <div id="projectDirectoryHolder"><input type="file" id="projectDirectory" nwdirectory></div>
      
      <div class="topcoat-button-bar">
          <div class="topcoat-button-bar__item">
              <button id="createProject" class="topcoat-button-bar__button"></button>
          </div>
          <div class="topcoat-button-bar__item">
              <button id="openProject" class="topcoat-button-bar__button"></button>  
          </div>
          <div class="topcoat-button-bar__item">
              <button id="serveProject" class="topcoat-button-bar__button"></button> 
          </div>
          <div class="topcoat-button-bar__item">
              <button id="stopServer" class="topcoat-button-bar__button"></button> 
          </div>
          <div class="topcoat-button-bar__item">
              <button id="settings" class="topcoat-button-bar__button"></button> 
          </div>
      </div> 
          
  </body>
</html>     

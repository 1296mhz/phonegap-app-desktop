<!DOCTYPE html>
<html>
  <head>
    <title>PhoneGap</title> 
     
    <script src="js/jquery-2.0.3.min.js"></script>   
    <script>
        var fs = require("fs");
        var path = require("path");
        global.pg = require("phonegap");
    
        global.jQuery = jQuery;

        global.jQuery(document).ready(function() {
           console.log("ready"); 
           global.projDir = "";
           
           global.pg.on("log", function(status, url) { 
               console.log(status, url); 
           });
           
           global.jQuery("#projectDirectory").change(function() {
               console.log("change handler");
               console.log(global.jQuery("#projectDirectory").val());
               global.projDir = global.jQuery("#projectDirectory").val();
               
               if (global.projDir != "") {
                   global.jQuery("#createProject").prop("disabled", false);
                   global.jQuery("#openProject").prop("disabled", false);
                   global.jQuery("#serveProject").prop("disabled", false);
               }
           });
           
           global.jQuery("#createProject").click(function() {
               console.log("create project click handler");
               var option = {};
               option.path = global.projDir;
               global.pg.create(option);
           });
           
           global.jQuery("#openProject").click(function() {
               console.log("open project click handler");
              
               fs.exists(global.projDir + "/www", function(exists) {
                   if (exists) {
                       process.chdir(global.projDir);
                       console.log("project opened at: " + global.projDir);
                   } else {
                       var errMsg = "an existing project doesn't exist in this folder";
                       console.log(errMsg);
                       alert(errMsg);
                   }
               });
              
           });
           
           global.jQuery("#serveProject").click(function() {
              console.log("serve project click handler");
              
              process.chdir(global.projDir);
              
              global.pg.serve({ port: 1337 }, function(e, options) { 
                  if (e) { 
                      console.log("error:", e.message);
                      alert(e.message); 
                  } else { 
                      console.log("server started at address: " + options.address + ":" + options.port); 
                  }
              });         
           });
                      
           global.jQuery("#createProject").val("create a new project");
           global.jQuery("#createProject").prop("disabled", true);
           
           global.jQuery("#openProject").val("open a project");
           global.jQuery("#openProject").prop("disabled", true);
           
           global.jQuery("#serveProject").val("serve a project");
           global.jQuery("#serveProject").prop("disabled", true);
           
        });
        
    </script> 
    <script src="js/index.js"></script> 
     
  </head>
  <body>

      <h1>PhoneGap GUI</h1> 

      Set project directory <input type="file" id="projectDirectory" nwdirectory><br> 
       
      <input type="button" id="createProject"><br>

      <input type="button" id="openProject"><br>
      
      <input type="button" id="serveProject"><br>
            
  </body>
</html>     

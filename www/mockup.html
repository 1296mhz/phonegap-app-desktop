<!DOCTYPE html>
<html>
<head>
    <title>PhoneGap</title>
    <link rel="stylesheet" type="text/css" href="css/index.css">
    <link rel='stylesheet' type='text/css' href='css/animation.css'>
    <link rel="stylesheet" type="text/css" href="css/topcoat-desktop-light.min.css">
    <link rel="stylesheet" type="text/css" href="css/topcoat-overlay.min.css">
    <link rel="stylesheet" type="text/css" href="css/topcoat-overlay-custom.css">
    <link rel="stylesheet" type="text/css" href="css/flexboxgrid.min.css">
    <script type="text/javascript" src="js/jquery-2.0.3.min.js"></script> 
    <script type='text/javascript' src='js/index.js'></script>
    <script type="text/javascript" src="js/sidebar-handlers.js"></script>
    <script type="text/javascript" src="js/server-status.js"></script>
    <script type="text/javascript" src="js/drag-n-drop-handlers.js"></script>
    <script type="text/javascript" src="js/project-create-open-handlers.js"></script>
    <script type="text/javascript" src="js/project-widget.js"></script>
    <script type="text/javascript" src="js/localStorage.js"></script>
    <script type="text/javascript" src="js/settings-handlers.js"></script>
    <script type='text/javascript'>   

    global.pgServer = require("connect-phonegap"); 
    global.pgVersion = "3.3.0";  
    global.jQuery = jQuery;
    global.createClicked = false;
    global.server = null;
    global.isServerRunning = false;

    // set default port number it has not been set
    if (!localStorage.portNumber) {
        localStorage.portNumber = 3000;
    }

    global.jQuery(document).ready(function() {

        global.jQuery("#projectDirectory").hide();
        global.jQuery("#newProjectOverlay").hide();
        global.jQuery("#createOpenProjectOverlay").hide();
        global.jQuery("#removeProjectOverlay").hide();
        global.jQuery("#settingsOverlay").hide();
        global.jQuery("#serverLogOverlay").hide();
        global.jQuery("#overlay-bg").hide();

        global.jQuery("#drop_zone").on("drop", handleDrop);
        global.jQuery("#drop_zone").on("dragover", handleDragOver);

        global.jQuery("#projectDirectory").change(selectDirectory);

        global.jQuery("#overlay-bg").click(overlayBackgroundHandler)

        global.jQuery("#addNewProject").click(createProject);
        global.jQuery("#chooseNewProjectPath").click(selectProjectPath);
        global.jQuery("#cancelNewProject").click(overlayBackgroundHandler);

        global.jQuery("#createProject").click(function() {
            global.jQuery("#newProjectOverlay").addClass("slideDown");
            displayAddNewProjectOverlay();
        });
        global.jQuery("#openProject").click(openProject);

        global.jQuery("#removeProject").click(removeProjectWidget);
        global.jQuery("#cancelRemoveProject").click(hideRemoveProjectOverlay);

        global.jQuery("#saveSettings").click(saveSettings);
        global.jQuery("#cancelSettings").click(cancelSettings);

        global.jQuery("#closeServerLog").click(function() {
            global.jQuery("#serverLogOverlay").hide();
            global.jQuery("#overlay-bg").hide();
        });

        global.jQuery("#plus").click(function() {
            global.jQuery("#createOpenProjectOverlay").addClass("slideRight");
            displayAddCreateProjectOverlay(); 
        });
        global.jQuery("#minus").click(displayRemoveProjectOverlay);
        global.jQuery("#settings").click(displaySettingsOverlay);
        global.jQuery("#log").click(toggleLog);
        
        global.jQuery("#plus-icon").on("mouseout", function() {
            if (!global.jQuery("#overlay-bg").is(":visible")) {
                MouseOut(this, 'img/icons/normal/plus.svg');
            }
        });

        global.jQuery("#minus-icon").on("mouseout", function() {
            if (!global.jQuery("#overlay-bg").is(":visible")) {
                MouseOut(this, 'img/icons/normal/minus.svg');
            }
        });
        
        global.jQuery("#settings-icon").on("mouseout", function() {
            if (!global.jQuery("#overlay-bg").is(":visible")) {
                MouseOut(this, 'img/icons/normal/settings.svg');
            }
        });
        
        getProjects();
    });

    function MouseRollover(img, src) {
        img.src = src;
    }
    
    function MouseOut(img, src) {
        img.src = src;
    }

    </script>
</head>
<body style="overflow-x: hidden; overflow-y: hidden;">

    <div id="overlay-bg" class="topcoat-overlay-bg-grey"></div>

    <aside id="removeProjectOverlay" class="topcoat-overlay-bottom">
        Are you sure you want to remove this project?
        <br>
        <button id="removeProject" class="topcoat-button">Remove Project</button>
        <button id="cancelRemoveProject" class="topcoat-button">Cancel</button>
    </aside>    
    <aside id="settingsOverlay" class="topcoat-overlay-bottom">
        Server Settings
        <br>
        Port: <input type="text" id="portNumber" class="topcoat-text-input">
        <br>
        <button id="saveSettings" class="topcoat-button">Save</button>
        <button id="cancelSettings" class="topcoat-button">Cancel</button>
    </aside>    
    <aside id="serverLogOverlay" class="topcoat-overlay-large">
        Server Log
        <br>
        <textarea id="serverLog" class="topcoat-textarea" readonly style="width: 90%; height: 90%;"></textarea>
        <br>
        <button id="closeServerLog" class="topcoat-button">Close</button>
    </aside> 
    <aside id="newProjectOverlay" class="new-project-overlay">
        <div class="new-project-form-item-heading">
            Name:
        </div>
        <div class="new-project-form-item">
            <input type="text" id="projectName" class="topcoat-text-input" style="width: 100%;">
        </div>
        <div class="new-project-form-item new-project-form-item-description">
            The display name for your app.
        </div>
        <div class="new-project-form-item-heading">
            ID:
        </div>
        <div class="new-project-form-item">
            <input type="text" id="project-id" class="topcoat-text-input" style="width: 100%;">
        </div>
        <div class="new-project-form-item new-project-form-item-description">
            The unique identifier across app stores. We recommend you use a reverse domain namespace format, for example: com.mydomain.funkyyapp
        </div>
        <div class="new-project-form-item-heading">
            Local path:
        </div>
        <div class="new-project-form-item">
            <input type="text" id="projectPath" class="topcoat-text-input" style="width: 245px;" readonly>
            <button id="chooseNewProjectPath" class="new-project-choose-button">Choose...</button>
        </div>
        <div class="new-project-form-item new-project-form-item-description">
            This is where the project will be stored on your computer.
        </div>
        <div class="new-project-form-item"> 
            <hr class="dotted-hr" />
        </div>
        <div class="new-project-form-item">            
            <button id="cancelNewProject" class="new-project-cancel-button">Cancel</button>
            <button id="addNewProject" class="new-project-add-button">Create project</button>
        </div>         
    </aside>
    <aside id="createOpenProjectOverlay" class="create-overlay">
        <div id="createProject" class="add-open-button">Create new PhoneGap project</div>
        <div id="openProject" class="add-open-button">Add existing PhoneGap project</div>
    </aside>

    <div class="row container" style="overflow-x: hidden; overflow-y: hidden;">
        <div class="column-2-hand sidebar">
            <div id="plus-holder" class="box-row center-hand">
                <button id="plus" class="sidebarbutton" title="Add / Open Project">
                    <img id="plus-icon" src="img/icons/normal/plus.svg" onMouseOver="MouseRollover(this, 'img/icons/hover/plus-hover.svg');" />
                </button>
            </div>
            <div id="minus-holder" class="box-row center-hand">
                <button id="minus" class="sidebarbutton" title="Remove Project" disabled>
                    <img id="minus-icon" src="img/icons/normal/minus.svg" onMouseOver="MouseRollover(this, 'img/icons/hover/minus-hover.svg');" />
                </button>
            </div>
            <div id="settings-holder" class="box-row center-hand">
                <button id="settings" class="sidebarbutton" title="Settings">
                    <img id="settings-icon" src="img/icons/normal/settings.svg" onMouseOver="MouseRollover(this, 'img/icons/hover/settings-hover.svg');" />
                </button>   
            </div>
            <div class="box-row center-hand">
                <button id="log" class="sidebarbutton" title="View Server Log" disabled>
                    <img id="log-icon" src="img/icons/normal/log.svg" onMouseOver="MouseRollover(this, 'img/icons/hover/log-hover.svg');" onMouseOut="MouseOut(this, 'img/icons/normal/log.svg');" />
                </button>   
            </div>
            <div class="box-row center-hand">
                <button id="help" class="sidebarbutton" title="Help" disabled>
                    <img id="help-icon" src="img/icons/normal/help.svg" onMouseOver="MouseRollover(this, 'img/icons/hover/help-hover.svg');" onMouseOut="MouseOut(this, 'img/icons/normal/help.svg');" />
                </button>   
            </div>
        </div>
        <div class="column-10-hand">
            <div id="guide-add" class="center-hand">
                <img src="img/icons/normal/dragdrop.svg" />
            </div>
            <div id="drop_zone" class="box-row dropzone"></div>
        </div>
        <input type="file" id="projectDirectory" nwdirectory>
    </div>

    <div class="row">
        <div class="column-2-hand sidebar-bottom">
            <div class="box-row">&nbsp;</div>
        </div>
        <div class="column-10-hand">
            <div class="status-field" id="status-field">
                <label id="server-status-label">server is offline</label>
            </div>    
        </div>
    </div>

</body>
</html>
